!function(t){var e,i,n,o=Object.prototype.hasOwnProperty;t.plot.plugins.push({init:function(r,s){var a=s.Canvas;null==e&&(i=a.prototype.getTextInfo,n=a.prototype.addText,e=a.prototype.render),a.prototype.render=function(){if(!r.getOptions().canvas)return e.call(this);var t=this.context,i=this._textCache;for(var n in t.save(),t.textBaseline="middle",i)if(o.call(i,n)){var s=i[n];for(var a in s)if(o.call(s,a)){var l=s[a],h=!0;for(var f in l)if(o.call(l,f)){var p=l[f],c=p.positions,v=p.lines;h&&(t.fillStyle=p.font.color,t.font=p.font.definition,h=!1);for(var d,g=0;d=c[g];g++)if(d.active)for(var u,y=0;u=d.lines[y];y++)t.fillText(v[y].text,u[0],u[1]);else c.splice(g--,1);0==c.length&&delete l[f]}}}t.restore()},a.prototype.getTextInfo=function(e,n,o,s,a){if(!r.getOptions().canvas)return i.call(this,e,n,o,s,a);var l,h,f,p;if(n=""+n,l="object"==typeof o?o.style+" "+o.variant+" "+o.weight+" "+o.size+"px "+o.family:o,null==(h=this._textCache[e])&&(h=this._textCache[e]={}),null==(f=h[l])&&(f=h[l]={}),null==(p=f[n])){var c=this.context;if("object"!=typeof o){var v=t("<div>&nbsp;</div>").css("position","absolute").addClass("string"==typeof o?o:null).appendTo(this.getTextLayer(e));(o={lineHeight:v.height(),style:v.css("font-style"),variant:v.css("font-variant"),weight:v.css("font-weight"),family:v.css("font-family"),color:v.css("color")}).size=v.css("line-height",1).height(),v.remove()}l=o.style+" "+o.variant+" "+o.weight+" "+o.size+"px "+o.family,p=f[n]={width:0,height:0,positions:[],lines:[],font:{definition:l,color:o.color}},c.save(),c.font=l;for(var d=(n+"").replace(/<br ?\/?>|\r\n|\r/g,"\n").split("\n"),g=0;g<d.length;++g){var u=d[g],y=c.measureText(u);p.width=Math.max(y.width,p.width),p.height+=o.lineHeight,p.lines.push({text:u,width:y.width,height:o.lineHeight})}c.restore()}return p},a.prototype.addText=function(t,e,i,o,s,a,l,h,f){if(!r.getOptions().canvas)return n.call(this,t,e,i,o,s,a,l,h,f);var p,c=this.getTextInfo(t,o,s,a,l),v=c.positions,d=c.lines;i+=c.height/d.length/2,i="middle"==f?Math.round(i-c.height/2):"bottom"==f?Math.round(i-c.height):Math.round(i),window.opera&&window.opera.version().split(".")[0]<12&&(i-=2);for(var g,u=0;g=v[u];u++)if(g.x==e&&g.y==i)return void(g.active=!0);for(g={active:!0,lines:[],x:e,y:i},v.push(g),u=0;p=d[u];u++)"center"==h?g.lines.push([Math.round(e-p.width/2),i]):"right"==h?g.lines.push([Math.round(e-p.width),i]):g.lines.push([Math.round(e),i]),i+=p.height}},options:{canvas:!0},name:"canvas",version:"1.0"})}(jQuery);